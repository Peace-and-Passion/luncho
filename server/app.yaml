#
# Configuration for Google Appengine Standard
#

env_variables:
  PRODUCTION:      true

  # If you use Google Cloud Storage for exchange rate backup, set a bucket name
  # Usually it is the same as the URL of GAE app. If you don't use, don't set it.
  GCS_BUCKET:      demandic-production.appspot.com

  # set you API key for exchange rates
  # FOREX_API_KEY:   XXXXXXXX

runtime: python311
entrypoint: gunicorn -b :$PORT --access-logfile - --error-logfile - -k uvicorn.workers.UvicornH11Worker -c gunicorn_config.py main:app

instance_class: F1
automatic_scaling:
  min_instances: 1
  max_instances: 1
#default_expiration: "100s"

handlers:
# Luncho API
- url: /v1/.*
  secure: always
  script: auto

# OpenAPI related pages served by FastAPI
- url: /redoc
  secure: always
  script: auto
- url: /doc
  secure: always
  script: auto
- url: /openapi.json
  secure: always
  script: auto

# static files
- url: /img
  static_dir: img

# index.html and bundle files for web site (the Luncho app)
- url: /index.html
  secure: always
  static_files: app-dist/index.html
  upload: app-dist/index.html
- url: /
  secure: always
  static_files: app-dist/index.html
  upload: app-dist/index.html

- url: /(.*\.(js|map|gif|png|jpg|ico|css))$
  secure: always
  static_files: app-dist/\1
  upload: app-dist/(.*\.(js|map|gif|png|jpg|ico|css))$

# All other routes to the bundle for pushState
- url: .*
  secure: always
  static_files: app-dist/index.html
  upload: app-dist/index.html
